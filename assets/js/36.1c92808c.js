(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{340:function(t,s,a){t.exports=a.p+"assets/img/openlayers_pbf.f4c8cef2.gif"},499:function(t,s,a){"use strict";a.r(s);var r=a(4),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("在"),s("a",{attrs:{href:"https://blog.csdn.net/m0_46281382/article/details/142878996?spm=1001.2014.3001.5501",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Worker 加载外部文件实践"),s("OutboundLink")],1),t._v("文中提到 Openlayers 加载外部 GEOJSON 文件渲染作为地图底图。当矢量数据很大，又不想加载图层服务时，可以考虑矢量切片。")]),t._v(" "),s("h3",{attrs:{id:"矢量切片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#矢量切片"}},[t._v("#")]),t._v(" 矢量切片")]),t._v(" "),s("p",[t._v("矢量切片是以金字塔方式切割矢量数据，切割的不是栅格图片，而是矢量数据的描述性文件，和常见的栅格切片是两码事。")]),t._v(" "),s("h3",{attrs:{id:"pbf-数据格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pbf-数据格式"}},[t._v("#")]),t._v(" PBF 数据格式")]),t._v(" "),s("p",[t._v("PBF 则是一种轻便、高效的结构化数据存储格式，可以用于结构化数据串行化或者序列化。很合适做数据存储或 RPC 数据交换格式。可用于通讯协议、数据存储等领域相关的语言无关】平台无关、可扩展的序列化结构数据格式。"),s("code",[t._v("MVT")]),t._v("("),s("code",[t._v("Mapbox Vector Tile")]),t._v(")就是采用 PBF（Protocol Buffer）格式组织单个切片内要素的信息。")]),t._v(" "),s("h4",{attrs:{id:"前端实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端实现"}},[t._v("#")]),t._v(" 前端实现")]),t._v(" "),s("p",[t._v("Openlayers 的 "),s("code",[t._v("ol/layer/VectorTile")]),t._v("类可以加载并渲染 pdf 文件。")]),t._v(" "),s("p",[t._v("核心代码如下：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" layer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VectorTile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("declutter")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("renderMode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vector"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VectorSource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MVT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("projection")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Projection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("code")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EPSG:4326"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("units")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"degrees"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8087/gis/xyz/getTile0190184030088408124620852/dxt_element_r/4326/{z}/{x}/{y}.PBF"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h4",{attrs:{id:"效果展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#效果展示"}},[t._v("#")]),t._v(" 效果展示")]),t._v(" "),s("p",[t._v("当放大或缩小地图时，Openlayers 会同加载栅格瓦片一样，通过通配符"),s("code",[t._v("{z}/{x}/{y}")]),t._v("去获取对应的 pbf 文件，pbf 文件本质上就是后端生成的一个二进制文件，体积很小。")]),t._v(" "),s("p",[t._v("效果如下：")]),t._v(" "),s("img",{attrs:{src:a(340)}}),t._v(" "),s("h4",{attrs:{id:"矢量切片优缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#矢量切片优缺点"}},[t._v("#")]),t._v(" 矢量切片优缺点")]),t._v(" "),s("p",[t._v("矢量切片 PBF 的优缺点如下：")]),t._v(" "),s("p",[s("strong",[t._v("优点")])]),t._v(" "),s("ul",[s("li",[t._v("相对于原始矢量数据，地图矢量切片更小巧，重新进行了编码，并进行了切分，只返回请求区域和相应级别的矢量数据。")]),t._v(" "),s("li",[t._v("数据信息接近无损，但体积更小，地图矢量切片的大小通常比地图栅格切片小，这使得数据传输得更快，可以使用更小的带宽。")]),t._v(" "),s("li",[t._v("数据在客户端渲染，而不是在服务器。这允许不同的地图应用程序使用不同的样式去渲染一个地图，而不需要事先在服务器进行预先的样式配置。")]),t._v(" "),s("li",[t._v("更灵活，可以只返回每个专题数据的图层，而不像地图栅格切片那样把很多专题数据渲染在一张底图中。")])]),t._v(" "),s("p",[s("strong",[t._v("缺点")])]),t._v(" "),s("ul",[s("li",[t._v("地图矢量切片只能用于渲染。虽然是矢量格式，但它们不可编辑，地图矢量切片是为了读取和渲染的优化。")])]),t._v(" "),s("h3",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("矢量切片最合适的应用方向就是在对于渲染速度有要求的前提下使用，因为无法修改切片的样式。")])])}),[],!1,null,null,null);s.default=e.exports}}]);