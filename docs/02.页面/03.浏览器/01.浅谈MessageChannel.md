---
title: æµ…è°ˆ MessageChannel
date: 2024-05-14 17:10:10
permalink: /pages/847sfc95e34sbi
categories:
  - HTML
  - æµè§ˆå™¨
  - é€šä¿¡
tags:
  - null
author:
  name: ä¸œæµ
  link: https://github.com/Jinuss
---

`MessageChannel` æ˜¯ä¸€ä¸ªç”¨äºåœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„æ¥å£ã€‚å®ƒå…è®¸ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ä»»ä½•åŒæ­¥æœºåˆ¶ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥è®©ä¸¤ä¸ªä¸åŒçš„è„šæœ¬è¿è¡Œåœ¨åŒä¸€ä¸ªæ–‡æ¡£çš„ä¸åŒæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œï¼ˆä¾‹å¦‚ä¸¤ä¸ª iframeï¼Œæ–‡æ¡£ä¸»ä½“å’Œä¸€ä¸ª iframeã€ä½¿ç”¨ sharedWorker çš„ä¸¤ä¸ªæ–‡æ¡£æˆ–ä¸¤ä¸ª workerï¼‰æ¥ç›´æ¥é€šè®¯ï¼Œåœ¨æ¯ç«¯ä½¿ç”¨ä¸€ä¸ªç«¯å£ port é€šè¿‡åŒå‘é¢‘é“ channel å‘å½¼æ­¤ä¼ é€’æ¶ˆæ¯ã€‚

`MessageChannel`æ˜¯ä»¥`DOM Event`çš„å½¢å¼å‘é€æ¶ˆæ¯ï¼Œå› æ­¤å®ƒå±äºå¼‚æ­¥çš„å®ä»»åŠ¡ã€‚

`MessageChannel` å¦‚æœä½¿ç”¨`addEventListener`æ–¹å¼ç›‘å¬`message`äº‹ä»¶ï¼Œé‚£ä¹ˆ`message`äº‹ä»¶ä¼šåœ¨`DOM Event`ä¹‹åè§¦å‘,å¹¶ä¸”åœ¨æ­¤ä¹‹å‰éœ€è¦æ‰‹åŠ¨è°ƒç”¨`start()`æ–¹æ³•æ‰èƒ½ä½¿æ¶ˆæ¯æµåŠ¨ï¼Œè€Œ`onmessage`æ–¹å¼ç›‘å¬åˆ™ä¼šåœ¨`DOM Event`ä¹‹å‰è§¦å‘ï¼Œä¸”è‡ªåŠ¨è°ƒç”¨`start()`æ–¹æ³•ã€‚

å…·ä½“ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹

1. åˆ›å»º`MessageChannel`å®ä¾‹ï¼ˆé€šè®¯é€šé“ï¼‰ï¼Œ`new MessageChannel()`ä¼šè¿”å›ä¸¤ä¸ªç«¯å£ MessagePort å¯¹è±¡`port1`ã€`port1`
2. `port1`ã€`port2`åˆ†åˆ«ç”¨äº`postMessage`å‘é€æ¶ˆæ¯å’Œ`onmessage`æ¥æ”¶æ¶ˆæ¯
3. `MessageChannel`å®ç°æ¶ˆæ¯ä¼ é€’æ˜¯æ·±æ‹·è´ï¼Œå› æ­¤æ¶ˆæ¯éœ€è¦æ˜¯å¯ä»¥è¿›è¡Œååºåˆ—åŒ–çš„å¤§å¤šæ•°åŸå§‹å¯¹è±¡ï¼Œåƒ`Symbole`ã€`Function`åˆ™ä¸èƒ½ç”¨ä½œæ¶ˆæ¯
4. è°ƒç”¨`close`æ–¹æ³•å…³é—­ç«¯å£ï¼Œå°†ä¸èƒ½å‘è¯¥ç«¯å£å‘é€æ¶ˆæ¯

ç¤ºä¾‹

```js
var channel = new MessageChannel();
console.log("ğŸš€ ~ channel:", channel);
var port1 = channel.port1;
console.log("ğŸš€ ~ port1:", port1);
var port2 = channel.port2;
console.log("ğŸš€ ~ port2:", port2);

port1.onmessage = function (event) {
  console.log("port1ï¼š" + event.data);
};

port2.onmessage = function (event) {
  console.log("port2ï¼š" + event.data);
};

port1.postMessage("æˆ‘æ˜¯port1ï¼Œå‘é€ç»™port2");
port2.postMessage("æˆ‘æ˜¯port2ï¼Œå‘é€ç»™port1");
port1.close();
```
