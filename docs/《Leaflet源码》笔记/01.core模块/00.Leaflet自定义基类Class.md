---
title: Leaflet自定义基类Class
date: 2025-03-11 15:39:18
permalink: /pages/f7577e/
categories:
  - 《Leaflet源码》笔记
  - core模块
tags:
  -
author:
  name: 东流
  link: https://github.com/Jinuss
---

```js
export function Class() {}

Class.extend = function (props) {
  var NewClass = function () {
    Util.setOptions(this);
    if (this.initialize) {
      this.initialize.apply(this, arguments);
    }
    this.callInitHooks();
  };

  var parentProto = (NewClass.__super__ = this.prototype);
  var proto = Util.create(parentProto);
  proto.constructor = NewClass;

  NewClass.prototype = proto;

  for (var i in this) {
    if (
      Object.prototype.hasOwnProperty.call(this, i) &&
      i !== "prototype" &&
      i !== "__super__"
    ) {
      NewClass[i] = this[i];
    }
  }

  if (props.statics) {
    Util.extend(NewClass, props.statics);
  }

  if (props.includes) {
    checkDeprecatedMixinEvents(props.includes);
    Util.extend.apply(null, [proto].concat(props.includes));
  }

  Util.extend(proto, props);

  delete proto.statics;
  delete proto.includes;

  if (proto.options) {
    proto.options = parentProto.options ? Util.create(parentProto.options) : {};
    Util.extend(proto.options, props.options);
  }

  proto._initHooks = [];
  proto.callInitHooks = function () {
    if (this._initHooksCalled) {
      return;
    }

    if (parentProto.callInitHooks) {
      parentProto.callInitHooks.call(this);
    }

    this._initHooksCalled = true;

    for (var i = 0, len = proto._initHooks.length; i < len; i++) {
      proto._initHooks[i].call(this);
    }
  };

  return NewClass;
};

Class.include = function (props) {
  var parentOptions = this.prototype.options;
  Util.extend(this.prototype, props);
  if (props.options) {
    this.prototype.options = parentOptions;
    this.mergeOptions(props.options);
  }

  return this;
};

Class.mergeOptions = function (props) {
  Util.extend(this.prototype.options, props);
  return this;
};

Class.addInitHook = function (fn) {
  var args = Array.prototype.slice.call(arguments, 1);

  var init =
    typeof fn === "function"
      ? fn
      : function () {
          this[fn].apply(this, args);
        };

  this.prototype._initHooks = this.prototype._initHooks || [];
  this.prototype._initHooks.push(init);
  return this;
};
```
